<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyectos | Arnaitz Penilla</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav>
        <a class="brand" href="index.html" aria-label="Ir a la página de inicio">
        <span class="brand-mark" aria-hidden="true">AP</span>
        <span class="brand-text">Arnaitz Penilla</span>
        </a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="proyectos.html" class="active">Proyectos</a>
            <a href="about.html">About</a>
            <a href="contacto.html">Contacto</a>
        </div>
    </nav>

    <main>

        <!-- ===================== PROYECTO 1 ===================== -->
        <section class="project-container" style="padding-top: 150px;">
            <div class="project-header">
                <h2 class="project-title">Senderos de Gloria</h2>
                <h3 style="color:var(--text-secondary)">Mina Abandonada & Sistema de Cuevas</h3>
            </div>

            <div class="project-meta">
                <div>
                    <strong>ROL</strong><br>
                    Environment Artist (Creación completa)
                </div>
                <div>
                    <strong>HERRAMIENTAS</strong><br>
                    Unreal Engine 5 (Lumen/Nanite), Blender, Substance Painter, Quixel
                </div>
                <div>
                    <strong>TIPO</strong><br>
                    Entorno 3D Realista / Modular
                </div>
            </div>

            <div class="project-description">
                <p><strong>Resumen:</strong> Entorno 3D realista desarrollado en Unreal Engine 5 que recrea un sistema de cuevas naturales conectadas con una mina abandonada. El proyecto se centra en la iluminación atmosférica, materiales PBR y narrativa ambiental.</p>
                <br>
                <p><strong>Retos Técnicos:</strong> Mantener la lectura visual en baja iluminación, efecto de humedad y reflejos en un entorno oscuro y opresivo pero con personalidad utilizando Lumen.</p>
            </div>

            <!-- Galería: grande (crossfade) + miniaturas -->
            <div class="project-gallery"
                 data-interval="6000"
                 data-fade="900"
                 data-images="Mina_abandonada_2.png|Mina_abandonada_1.png|Mina_abandonada_3.png|Mina_abandonada_4.png|Mina_abandonada_5.png|Mina_abandonada_6.png"
                 data-alts="Render principal de la mina abandonada|Detalle de entrada de la mina|Pasillos de la mina con niebla volumétrica|Render de mina 4|Render de mina 5|Render de mina 6">

                <div class="project-main-frame show-a" aria-label="Imagen principal del proyecto">
                    <img class="project-main project-main-a" src="Mina_abandonada_2.png" alt="Render principal de la mina abandonada">
                    <img class="project-main project-main-b" src="" alt="">
                </div>

                <div class="project-thumbs" aria-label="Miniaturas (click para cambiar la imagen principal)">
                    <button class="thumb" type="button"><img alt=""></button>
                    <button class="thumb" type="button"><img alt=""></button>
                    <button class="thumb" type="button"><img alt=""></button>
	            <button class="thumb" type="button"><img alt=""></button>
                </div>
            </div>
        </section>


        <!-- ===================== PROYECTO 2 ===================== -->
        <section class="project-container" style="padding-top: 0;">
            <div class="project-header">
                <h2 class="project-title">Ecos del Bosque</h2>
                <h3 style="color:var(--text-secondary)">Entorno Natural & Vegetación</h3>
            </div>

            <div class="project-meta">
                <div>
                    <strong>ROL</strong><br>
                    Environment Artist, level Art & Lighting
                </div>
                <div>
                    <strong>HERRAMIENTAS</strong><br>
                    Unreal Engine 5 (Lumen/Nanite), Blender, Substance Painter, Quixel
                </div>
                <div>
                    <strong>ENFOQUE</strong><br>
                    Entorno 3D Realista, Iluminación natural y composición orgánica
                </div>
            </div>

            <div class="project-description">
		<p><strong>Resumen:</strong> Entorno 3D realista desarrollado en Unreal Engine 5 enfocado en la transición entre espacios densos de bosque y áreas abiertas de agua. El proyecto se centra en la dispersión de vegetación (foliage), la interacción de la luz solar con las copas de los árboles y la integración de assets naturales para crear una composición serena y orgánica.</p>
                <br>
                <p><strong>Retos Técnicos:</strong> Mantener una dispersión de vegetación correcta, combinando diferentes árboles y plantas para conseguir la sensación de un bosque grande y frondoso, pero con zonas diferenciales e interacción de luz solar y nocturna utilizando Lumen para conseguir un bosque con cierto misticismo y personalidad..</p>

            </div>

            <div class="project-gallery"
                 data-interval="6000"
                 data-fade="900"
                 data-images="Bosque_4.png|Bosque_1.png|Bosque_2.png|Bosque_3.png|Bosque_5.png|Bosque_6.png"
                 data-alts="Vista general del lago y el bosque|Camino forestal|Iluminación a través de los árboles|Vista del lago|Bosque 5">

                <div class="project-main-frame show-a" aria-label="Imagen principal del proyecto">
                    <img class="project-main project-main-a" src="Bosque_4.png" alt="Vista general del lago y el bosque">
                    <img class="project-main project-main-b" src="" alt="">
                </div>

                <div class="project-thumbs" aria-label="Miniaturas (click para cambiar la imagen principal)">
                    <button class="thumb" type="button"><img alt=""></button>
                    <button class="thumb" type="button"><img alt=""></button>
                    <button class="thumb" type="button"><img alt=""></button>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <p>© 2026 Arnaitz Penilla Ezcurra. Todos los derechos reservados.</p>
    </footer>

    <script>
    (function () {
      const THUMB_SLOTS = 3;

      function parsePipeList(str) {
        return (str || "")
          .split("|")
          .map(s => s.trim())
          .filter(Boolean);
      }

      function loadImage(src) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(src);
          img.onerror = () => reject(new Error("No se pudo cargar: " + src));
          img.src = src;
        });
      }

      async function initGallery(gallery) {
        const frame = gallery.querySelector(".project-main-frame");
        const imgA = gallery.querySelector(".project-main-a");
        const imgB = gallery.querySelector(".project-main-b");
        const thumbs = Array.from(gallery.querySelectorAll(".thumb"));

        let images = parsePipeList(gallery.dataset.images);
        let alts = parsePipeList(gallery.dataset.alts);

        const intervalMs = Number(gallery.dataset.interval || 6000);
        const fadeMs = Number(gallery.dataset.fade || 900);

        // Aplica duración del crossfade vía CSS variable
        frame.style.setProperty("--fade-ms", `${fadeMs}ms`);

        // Normaliza alts
        if (alts.length < images.length) {
          alts = alts.concat(Array.from({ length: images.length - alts.length }, () => "Imagen del proyecto"));
        }

        // Filtra imágenes que no cargan (evita negro)
        const results = await Promise.allSettled(images.map(loadImage));
        const ok = [];
        const okAlts = [];
        results.forEach((r, i) => {
          if (r.status === "fulfilled") {
            ok.push(images[i]);
            okAlts.push(alts[i]);
          } else {
            console.warn(r.reason?.message || r.reason);
          }
        });
        images = ok;
        alts = okAlts;

        if (images.length === 0) return;

        // Estado
        let currentIndex = 0;
        let showingA = true;
        let timer = null;

        // Asegura que src inicial existe en array; si no, usa 0
        const initialSrc = (imgA.getAttribute("src") || "").trim();
        const found = images.indexOf(initialSrc);
        if (found >= 0) currentIndex = found;

        function setVisibleInstant(idx) {
          currentIndex = idx;
          imgA.src = images[currentIndex];
          imgA.alt = alts[currentIndex];
          imgB.src = "";
          imgB.alt = "";
          frame.classList.add("show-a");
          frame.classList.remove("show-b");
          showingA = true;
        }

        async function transitionTo(idx) {
          if (idx === currentIndex) return;

          // Pre-carga la siguiente antes de hacer fade
          const nextSrc = images[idx];
          await loadImage(nextSrc).catch(() => null);

          const hidden = showingA ? imgB : imgA;
          hidden.src = nextSrc;
          hidden.alt = alts[idx];

          // Reflow para asegurar transición
          void frame.offsetWidth;

          if (showingA) {
            frame.classList.remove("show-a");
            frame.classList.add("show-b");
          } else {
            frame.classList.remove("show-b");
            frame.classList.add("show-a");
          }

          currentIndex = idx;
          showingA = !showingA;
        }

        function renderThumbs() {
          const thumbsWrap = gallery.querySelector(".project-thumbs");

          if (images.length <= 1) {
            thumbsWrap.style.display = "none";
            return;
          } else {
            thumbsWrap.style.display = "";
          }

          // Solo mostramos hasta THUMB_SLOTS o images.length-1
          const visibleCount = Math.min(THUMB_SLOTS, images.length - 1);

          thumbs.forEach((btn, slot) => {
            if (slot >= visibleCount) {
              btn.style.display = "none";
              return;
            }
            btn.style.display = "";

            const idx = (currentIndex + 1 + slot) % images.length;
            btn.dataset.index = String(idx);

            const imgEl = btn.querySelector("img");
            imgEl.src = images[idx];
            imgEl.alt = alts[idx];
          });
        }

        function restartTimer() {
          if (timer) clearInterval(timer);
          timer = setInterval(async () => {
            const next = (currentIndex + 1) % images.length;
            await transitionTo(next);
            renderThumbs();
          }, intervalMs);
        }

        // Click en miniaturas
        gallery.addEventListener("click", async (e) => {
          const btn = e.target.closest(".thumb");
          if (!btn || !gallery.contains(btn)) return;

          const idx = Number(btn.dataset.index);
          if (!Number.isFinite(idx)) return;

          await transitionTo(idx);
          renderThumbs();
          restartTimer();
        });

        // Inicial
        setVisibleInstant(currentIndex);
        renderThumbs();
        restartTimer();
      }

      document.querySelectorAll(".project-gallery").forEach(initGallery);
    })();
    </script>

</body>
</html>
